<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gold Investment Calculator</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
            min-height: 100vh;
        }
        .header {
            text-align: center;
            margin-bottom: 24px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            color: white;
        }
        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        .card {
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .card h3 {
            font-size: 18px;
            margin-bottom: 12px;
            color: #667eea;
        }
        .child-info {
            display: grid;
            gap: 8px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }
        .info-label {
            font-weight: 600;
            color: #666;
        }
        .info-value {
            font-weight: 500;
        }
        .add-button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
        }
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèÜ Gold Investment</h1>
        <p>–ü–ª–∞–Ω –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –∑–æ–ª–æ—Ç–∞ –¥–ª—è –¥–µ—Ç–µ–π</p>
    </div>

    <div id="user-info" style="margin-bottom: 16px; padding: 12px; background: #e3f2fd; border-radius: 8px; font-size: 14px;">
        <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> <span id="username">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
    </div>

    <div id="content">
        <div class="loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
    </div>

    <button class="add-button" onclick="addChild()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–±—ë–Ω–∫–∞</button>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // API URL (–ø–æ–º–µ–Ω—è–π –Ω–∞ —Å–≤–æ–π –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è)
        const API_URL = 'http://const API_URL = 'https://gold-investment-api1-bzyha5pic-artemb08s-projects.vercel.app/api';

        // –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const user = tg.initDataUnsafe.user;
        const userId = user ? user.id : 123456; // –î–ª—è —Ç–µ—Å—Ç–∞

        document.getElementById('username').textContent = user ? 
            `${user.first_name} (ID: ${userId})` : 
            '–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (ID: 123456)';

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ—Ç–µ–π
        async function loadChildren() {
            try {
                const response = await fetch(`${API_URL}/children/${userId}`);
                const data = await response.json();
                
                const content = document.getElementById('content');
                
                if (Object.keys(data).length === 0) {
                    content.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üë∂</div>
                            <p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–µ—Ç–µ–π</p>
                            <p style="font-size: 12px; margin-top: 8px;">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</p>
                        </div>
                    `;
                } else {
                    content.innerHTML = Object.entries(data).map(([id, child]) => `
                        <div class="card">
                            <h3>${child.name}</h3>
                            <div class="child-info">
                                <div class="info-row">
                                    <span class="info-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</span>
                                    <span class="info-value">${child.birth_date}</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">–¶–µ–ª–µ–≤–æ–π –≤–æ–∑—Ä–∞—Å—Ç:</span>
                                    <span class="info-value">${child.target_age_years || '‚Äî'} –ª–µ—Ç</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">–ë—é–¥–∂–µ—Ç:</span>
                                    <span class="info-value">${child.monthly_budget_eur} EUR/–º–µ—Å</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">–ú–µ—Å—è—Ü–µ–≤ –≤ –ø–ª–∞–Ω–µ:</span>
                                    <span class="info-value">${child.plan_rows.length}</span>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading children:', error);
                document.getElementById('content').innerHTML = `
                    <div class="card" style="color: #d32f2f;">
                        <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ API –∑–∞–ø—É—â–µ–Ω.</p>
                        <p style="font-size: 12px; margin-top: 8px;">${error.message}</p>
                    </div>
                `;
            }
        }

        // –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–±—ë–Ω–∫–∞ (–ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –∞–ª–µ—Ä—Ç)
        function addChild() {
            tg.showAlert('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–±—ë–Ω–∫–∞ –ø–æ–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞! –ù–∞–ø–∏—à–∏—Ç–µ /start –≤ —á–∞—Ç–µ —Å –±–æ—Ç–æ–º.');
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        loadChildren();
    </script>
</body>
</html>


